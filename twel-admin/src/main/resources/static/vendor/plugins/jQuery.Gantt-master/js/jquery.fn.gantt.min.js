// jQuery Gantt Chart
// Distributed under an MIT license.
// https://github.com/mbielanczuk/jQuery.Gantt
(function(e){"use strict";e.fn.gantt=function(t){function s(e,t){for(var n=1;;n++){var r=new Date(e);r.setHours(e.getHours()+t*n);if(r.getTime()!==e.getTime()){return r}}}var n="jquery.fn.gantt";var r=["hours","days","weeks","months"];var i={source:[],itemsPerPage:7,months:["January","February","March","April","May","June","July","August","September","October","November","December"],dow:["S","M","T","W","T","F","S"],startPos:new Date,navigate:"buttons",scale:"days",useCookie:false,maxScale:"months",minScale:"hours",waitText:"Please wait...",onItemClick:function(e){return},onAddClick:function(e){return},onRender:function(){return},onDataLoadFailed:function(e){return},scrollToToday:true};if(t){e.extend(i,t)}i.useCookie=i.useCookie&&e.isFunction(e.cookie);e.extend(e.expr[":"],{findday:function(t,n,r){var i=new Date(parseInt(r[3],10));var s=e(t).attr("id");s=s?s:"";var o=s.indexOf("-")+1;var u=new Date(parseInt(s.substring(o,s.length),10));i=new Date(i.getFullYear(),i.getMonth(),i.getDate());u=new Date(u.getFullYear(),u.getMonth(),u.getDate());return i.getTime()===u.getTime()}});e.extend(e.expr[":"],{findweek:function(t,n,r){var i=new Date(parseInt(r[3],10));var s=e(t).attr("id");s=s?s:"";var o=s.indexOf("-")+1;i=i.getFullYear()+"-"+i.getDayForWeek().getWeekOfYear();var u=s.substring(o,s.length);return i===u}});e.extend(e.expr[":"],{findmonth:function(t,n,r){var i=new Date(parseInt(r[3],10));i=i.getFullYear()+"-"+i.getMonth();var s=e(t).attr("id");s=s?s:"";var o=s.indexOf("-")+1;var u=s.substring(o,s.length);return i===u}});Date.prototype.getWeekId=function(){var e=this.getFullYear();var t=this.getDayForWeek().getWeekOfYear();var n=this.getMonth();if(n===11&&t===1){e++}return"dh-"+e+"-"+t};Date.prototype.getRepDate=function(){switch(i.scale){case"hours":return this.getTime();case"weeks":return this.getDayForWeek().getTime();case"months":return(new Date(this.getFullYear(),this.getMonth(),1)).getTime();default:return this.getTime()}};Date.prototype.getDayOfYear=function(){var e=new Date(this.getFullYear(),0,0);var t=new Date(this.getFullYear(),this.getMonth(),this.getDate());return Math.ceil((t-e)/864e5)};Date.prototype.getWeekOfYear=function(){var e=new Date(this.getFullYear(),0,1);var t=new Date(this.getTime());t.setDate(t.getDate()+4-(t.getDay()||7));return Math.floor(Math.round((t-e)/864e5)/7)+1};Date.prototype.getDaysInMonth=function(){return 32-(new Date(this.getFullYear(),this.getMonth(),32)).getDate()};Date.prototype.hasWeek=function(){var e=new Date(this.valueOf());e.setDate(e.getDate()-e.getDay());var t=new Date(this.valueOf());t.setDate(t.getDate()+(6-t.getDay()));if(e.getMonth()===t.getMonth()){return true}else{return e.getMonth()===this.getMonth()&&t.getDate()<4||e.getMonth()!==this.getMonth()&&t.getDate()>=4}};Date.prototype.getDayForWeek=function(){var e=new Date(this.valueOf());e.setDate(e.getDate()-e.getDay());var t=new Date(this.valueOf());t.setDate(t.getDate()+(6-t.getDay()));if(e.getMonth()===t.getMonth()||e.getMonth()!==t.getMonth()&&t.getDate()>=4){return new Date(t.setDate(t.getDate()-3))}else{return new Date(e.setDate(e.getDate()+3))}};var o={elementFromPoint:function(t,n){if(!e.support.boxModel){t-=e(document).scrollLeft();n-=e(document).scrollTop()}else{t-=window.pageXOffset;n-=window.pageYOffset}return document.elementFromPoint(t,n)},create:function(t){if(typeof i.source!=="string"){t.data=i.source;o.init(t)}else{e.getJSON(i.source,function(e){t.data=e;o.init(t)})}},init:function(t){try{t.rowsNum=t.data.length;t.pageCount=Math.ceil(t.rowsNum/i.itemsPerPage);t.rowsOnLastPage=t.rowsNum-Math.floor(t.rowsNum/i.itemsPerPage)*i.itemsPerPage;t.dateStart=u.getMinDate(t);t.dateEnd=u.getMaxDate(t);o.waitToggle(t,true,function(){o.render(t)})}catch(n){if(t.data===null||typeof t.data==="object"&&t.data.length===0)i.onDataLoadFailed(e(this).data("dataObj"))}},render:function(t){var n=e('<div class="fn-content"/>');var r=o.leftPanel(t);n.append(r);var s=o.rightPanel(t,r);var u,a;n.append(s);n.append(o.navigation(t));var f=s.find(".dataPanel");t.gantt=e('<div class="fn-gantt" />').append(n);e(t).html(t.gantt);t.scrollNavigation.panelMargin=parseInt(f.css("margin-left").replace("px",""),10);t.scrollNavigation.panelMaxPos=f.width()-s.width();t.scrollNavigation.canScroll=f.width()>s.width();o.markNow(t);o.fillData(t,f,r);if(i.useCookie){var l=e.cookie(this.cookieKey+"ScrollPos");if(l){t.hPosition=l}}if(i.scrollToToday){o.navigateTo(t,"now");o.scrollPanel(t,0)}else{if(t.hPosition!==0){if(t.scaleOldWidth){u=f.width()-s.width();a=u*t.hPosition/t.scaleOldWidth;a=a>0?0:a;f.css({"margin-left":a+"px"});t.scrollNavigation.panelMargin=a;t.hPosition=a;t.scaleOldWidth=null}else{f.css({"margin-left":t.hPosition+"px"});t.scrollNavigation.panelMargin=t.hPosition}o.repositionLabel(t)}}f.css({height:r.height()});o.waitToggle(t,false);i.onRender()},leftPanel:function(t){var n=e('<div class="leftPanel"/>').append(e('<div class="row spacer"/>').css("height",u.getCellSize()*t.headerRows+"px").css("width","100%"));var r=[];e.each(t.data,function(e,n){if(e>=t.pageNum*i.itemsPerPage&&e<t.pageNum*i.itemsPerPage+i.itemsPerPage){r.push('<div class="row name row'+e+(n.desc?"":" fn-wide")+'" id="rowheader'+e+'" offset="'+e%i.itemsPerPage*u.getCellSize()+'">');r.push('<span class="fn-label'+(n.cssClass?" "+n.cssClass:"")+'">'+(n.name||"")+"</span>");r.push("</div>");if(n.desc){r.push('<div class="row desc row'+e+' " id="RowdId_'+e+'" data-id="'+n.id+'">');r.push('<span class="fn-label'+(n.cssClass?" "+n.cssClass:"")+'">'+n.desc+"</span>");r.push("</div>")}}});n.append(r.join(""));return n},dataPanel:function(t,n){var r=e('<div class="dataPanel" style="width: '+n+'px;"/>');var s=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";if(document.attachEvent){t.attachEvent("on"+s,function(e){o.wheelScroll(t,e)})}else if(document.addEventListener){t.addEventListener(s,function(e){o.wheelScroll(t,e)},false)}r.click(function(n){n.stopPropagation();var r,s;var a=e(t).find(".fn-gantt .leftPanel");var f=e(t).find(".fn-gantt .dataPanel");switch(i.scale){case"weeks":s=u.getCellSize()*2;break;case"months":s=u.getCellSize();break;case"hours":s=u.getCellSize()*4;break;case"days":s=u.getCellSize()*3;break;default:s=u.getCellSize()*2;break}var l=o.elementFromPoint(n.pageX,f.offset().top+s);if(l.className==="fn-label"){l=e(l.parentNode)}else{l=e(l)}var c=l.attr("repdate");var h=o.elementFromPoint(a.offset().left+a.width()-10,n.pageY);if(h.className.indexOf("fn-label")===0){h=e(h.parentNode)}else{h=e(h)}var p=h.data().id;i.onAddClick(c,p)});return r},rightPanel:function(t,n){var r=null;var a=["sn","wd","wd","wd","wd","wd","sa"];var f=['<div class="row"/>'];var l=0;var c=['<div class="row"/>'];var h=0;var p=[];var d=0;var v=[];var m=[];var g=new Date;g=new Date(g.getFullYear(),g.getMonth(),g.getDate());var y=i.holidays?i.holidays.join():"";switch(i.scale){case"hours":r=u.parseTimeRange(t.dateStart,t.dateEnd,t.scaleStep);var b=r[0].getFullYear();var w=r[0].getMonth();var E=r[0];for(var S=0,x=r.length;S<x;S++){var T=r[S];var N=T.getFullYear();if(N!==b){f.push('<div class="row header year" style="width: '+u.getCellSize()*l+'px;"><div class="fn-label">'+b+"</div></div>");b=N;l=0}l++;var C=T.getMonth();if(C!==w){c.push('<div class="row header month" style="width: '+u.getCellSize()*h+'px"><div class="fn-label">'+i.months[w]+"</div></div>");w=C;h=0}h++;var k=T.getDay();var L=E.getDay();var A=a[k];var O=E.getTime();if(y.indexOf((new Date(T.getFullYear(),T.getMonth(),T.getDate())).getTime())>-1){A="holiday"}if(k!==L){var M=g-E===0?" today":y.indexOf(O)>-1?"holiday":a[L];p.push('<div class="row date '+M+'" '+' style="width: '+u.getCellSize()*d+'px;"> '+' <div class="fn-label">'+E.getDate()+"</div></div>");v.push('<div class="row day '+M+'" '+' style="width: '+u.getCellSize()*d+'px;"> '+' <div class="fn-label">'+i.dow[L]+"</div></div>");E=T;d=0}d++;m.push('<div class="row day '+A+'" id="dh-'+T.getTime()+'"  offset="'+S*u.getCellSize()+'"  repdate="'+T.getRepDate()+'"><div class="fn-label">'+T.getHours()+"</div></div>")}f.push('<div class="row header year" style="width: '+u.getCellSize()*l+'px;"><div class="fn-label">'+b+"</div></div>");c.push('<div class="row header month" style="width: '+u.getCellSize()*h+'px"><div class="fn-label">'+i.months[w]+"</div></div>");var A=a[E.getDay()];if(y.indexOf((new Date(E.getFullYear(),E.getMonth(),E.getDate())).getTime())>-1){A="holiday"}p.push('<div class="row date '+A+'" '+' style="width: '+u.getCellSize()*d+'px;"> '+' <div class="fn-label">'+E.getDate()+"</div></div>");v.push('<div class="row day '+A+'" '+' style="width: '+u.getCellSize()*d+'px;"> '+' <div class="fn-label">'+i.dow[E.getDay()]+"</div></div>");var _=o.dataPanel(t,r.length*u.getCellSize());_.append(f.join(""));_.append(c.join(""));_.append(e('<div class="row"/>').html(p.join("")));_.append(e('<div class="row"/>').html(v.join("")));_.append(e('<div class="row"/>').html(m.join("")));break;case"weeks":r=u.parseWeeksRange(t.dateStart,t.dateEnd);f=['<div class="row"/>'];c=['<div class="row"/>'];var b=r[0].getFullYear();var w=r[0].getMonth();var E=r[0];for(var S=0,x=r.length;S<x;S++){var T=r[S];if(T.getFullYear()!==b){f.push('<div class="row header year" style="width: '+u.getCellSize()*l+'px;"><div class="fn-label">'+b+"</div></div>");b=T.getFullYear();l=0}l++;if(T.getMonth()!==w){c.push('<div class="row header month" style="width:'+u.getCellSize()*h+'px;"><div class="fn-label">'+i.months[w]+"</div></div>");w=T.getMonth();h=0}h++;p.push('<div class="row day wd" '+' id="'+T.getWeekId()+'" offset="'+S*u.getCellSize()+'" repdate="'+T.getRepDate()+'"> '+' <div class="fn-label">'+T.getWeekOfYear()+"</div></div>")}f.push('<div class="row header year" style="width: '+u.getCellSize()*l+'px;"><div class="fn-label">'+b+"</div></div>");c.push('<div class="row header month" style="width: '+u.getCellSize()*h+'px"><div class="fn-label">'+i.months[w]+"</div></div>");var _=o.dataPanel(t,r.length*u.getCellSize());_.append(f.join("")+c.join("")+p.join("")+v.join(""));break;case"months":r=u.parseMonthsRange(t.dateStart,t.dateEnd);var b=r[0].getFullYear();var w=r[0].getMonth();var E=r[0];for(var S=0,x=r.length;S<x;S++){var T=r[S];if(T.getFullYear()!==b){f.push('<div class="row header year" style="width: '+u.getCellSize()*l+'px;"><div class="fn-label">'+b+"</div></div>");b=T.getFullYear();l=0}l++;c.push('<div class="row day wd" id="dh-'+u.genId(T.getTime())+'" offset="'+S*u.getCellSize()+'" repdate="'+T.getRepDate()+'">'+(1+T.getMonth())+"</div>")}f.push('<div class="row header year" style="width: '+u.getCellSize()*l+'px;"><div class="fn-label">'+b+"</div></div>");c.push('<div class="row header month" style="width: '+u.getCellSize()*h+'px"><div class="fn-label">'+i.months[w]+"</div></div>");var _=o.dataPanel(t,r.length*u.getCellSize());_.append(f.join(""));_.append(c.join(""));_.append(e('<div class="row"/>').html(p.join("")));_.append(e('<div class="row"/>').html(v.join("")));break;default:r=u.parseDateRange(t.dateStart,t.dateEnd);var D=s(r[0],-1);var b=D.getFullYear();var w=D.getMonth();var E=D;for(var S=0,x=r.length;S<x;S++){var T=r[S];if(T.getFullYear()!==b){f.push('<div class="row header year" style="width:'+u.getCellSize()*l+'px;"><div class="fn-label">'+b+"</div></div>");b=T.getFullYear();l=0}l++;if(T.getMonth()!==w){c.push('<div class="row header month" style="width:'+u.getCellSize()*h+'px;"><div class="fn-label">'+i.months[w]+"</div></div>");w=T.getMonth();h=0}h++;var L=T.getDay();var A=a[L];if(y.indexOf((new Date(T.getFullYear(),T.getMonth(),T.getDate())).getTime())>-1){A="holiday"}p.push('<div class="row date '+A+'" '+' id="dh-'+u.genId(T.getTime())+'" offset="'+S*u.getCellSize()+'" repdate="'+T.getRepDate()+'"> '+' <div class="fn-label">'+T.getDate()+"</div></div>");v.push('<div class="row day '+A+'" '+' id="dw-'+u.genId(T.getTime())+'"  repdate="'+T.getRepDate()+'"> '+' <div class="fn-label">'+i.dow[L]+"</div></div>")}f.push('<div class="row header year" style="width: '+u.getCellSize()*l+'px;"><div class="fn-label">'+b+"</div></div>");c.push('<div class="row header month" style="width: '+u.getCellSize()*h+'px"><div class="fn-label">'+i.months[w]+"</div></div>");var _=o.dataPanel(t,r.length*u.getCellSize());_.append(f.join(""));_.append(c.join(""));_.append(e('<div class="row" style="margin-left: 0;" />').html(p.join("")));_.append(e('<div class="row" style="margin-left: 0;" />').html(v.join("")));break}return e('<div class="rightPanel"></div>').append(_)},navigation:function(t){var n=null;if(i.navigate==="scroll"){n=e('<div class="navigate" />').append(e('<div class="nav-slider" />').append(e('<div class="nav-slider-left" />').append(e('<button type="button" class="nav-link nav-page-back"/>').html("&lt;").click(function(){o.navigatePage(t,-1)})).append(e('<div class="page-number"/>').append(e("<span/>").html(t.pageNum+1+" / "+t.pageCount))).append(e('<button type="button" class="nav-link nav-page-next"/>').html("&gt;").click(function(){o.navigatePage(t,1)})).append(e('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){o.navigateTo(t,"now")})).append(e('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){if(i.scale==="hours"){o.navigateTo(t,u.getCellSize()*8)}else if(i.scale==="days"){o.navigateTo(t,u.getCellSize()*30)}else if(i.scale==="weeks"){o.navigateTo(t,u.getCellSize()*12)}else if(i.scale==="months"){o.navigateTo(t,u.getCellSize()*6)}})).append(e('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){if(i.scale==="hours"){o.navigateTo(t,u.getCellSize()*4)}else if(i.scale==="days"){o.navigateTo(t,u.getCellSize()*7)}else if(i.scale==="weeks"){o.navigateTo(t,u.getCellSize()*4)}else if(i.scale==="months"){o.navigateTo(t,u.getCellSize()*3)}}))).append(e('<div class="nav-slider-content" />').append(e('<div class="nav-slider-bar" />').append(e('<a class="nav-slider-button" />')).mousedown(function(e){e.preventDefault();t.scrollNavigation.scrollerMouseDown=true;o.sliderScroll(t,e)}).mousemove(function(e){if(t.scrollNavigation.scrollerMouseDown){o.sliderScroll(t,e)}}))).append(e('<div class="nav-slider-right" />').append(e('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){if(i.scale==="hours"){o.navigateTo(t,u.getCellSize()*-4)}else if(i.scale==="days"){o.navigateTo(t,u.getCellSize()*-7)}else if(i.scale==="weeks"){o.navigateTo(t,u.getCellSize()*-4)}else if(i.scale==="months"){o.navigateTo(t,u.getCellSize()*-3)}})).append(e('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){if(i.scale==="hours"){o.navigateTo(t,u.getCellSize()*-8)}else if(i.scale==="days"){o.navigateTo(t,u.getCellSize()*-30)}else if(i.scale==="weeks"){o.navigateTo(t,u.getCellSize()*-12)}else if(i.scale==="months"){o.navigateTo(t,u.getCellSize()*-6)}})).append(e('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){o.zoomInOut(t,-1)})).append(e('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){o.zoomInOut(t,1)}))));e(document).mouseup(function(){t.scrollNavigation.scrollerMouseDown=false})}else{n=e('<div class="navigate" />').append(e('<button type="button" class="nav-link nav-page-back"/>').html("&lt;").click(function(){o.navigatePage(t,-1)})).append(e('<div class="page-number"/>').append(e("<span/>").html(t.pageNum+1+" of "+t.pageCount))).append(e('<button type="button" class="nav-link nav-page-next"/>').html("&gt;").click(function(){o.navigatePage(t,1)})).append(e('<button type="button" class="nav-link nav-begin"/>').html("&#124;&lt;").click(function(){o.navigateTo(t,"begin")})).append(e('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){o.navigateTo(t,u.getCellSize()*7)})).append(e('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){o.navigateTo(t,u.getCellSize())})).append(e('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){o.navigateTo(t,"now")})).append(e('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){o.navigateTo(t,u.getCellSize()*-1)})).append(e('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){o.navigateTo(t,u.getCellSize()*-7)})).append(e('<button type="button" class="nav-link nav-end"/>').html("&gt;&#124;").click(function(){o.navigateTo(t,"end")})).append(e('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){o.zoomInOut(t,-1)})).append(e('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){o.zoomInOut(t,1)}))}return e('<div class="bottom"/>').append(n)},createProgressBar:function(t,n,r,s,o){var a=u.getCellSize();var f=u.getProgressBarMargin()||0;var l=e('<div class="bar"><div class="fn-label">'+s+"</div></div>").addClass(n).css({width:a*t-f+2}).data("dataObj",o);if(r){l.mouseover(function(t){var n=e('<div class="fn-gantt-hint" />').html(r);e("body").append(n);n.css("left",t.pageX);n.css("top",t.pageY);n.show()}).mouseout(function(){e(".fn-gantt-hint").remove()}).mousemove(function(t){e(".fn-gantt-hint").css("left",t.pageX);e(".fn-gantt-hint").css("top",t.pageY+15)})}l.click(function(t){t.stopPropagation();i.onItemClick(e(this).data("dataObj"))});return l},markNow:function(t){switch(i.scale){case"weeks":var n=Date.parse(new Date);n=Math.floor(n/364e5)*364e5;e(t).find(':findweek("'+n+'")').removeClass("wd").addClass("today");break;case"months":e(t).find(':findmonth("'+(new Date).getTime()+'")').removeClass("wd").addClass("today");break;default:var n=Date.parse(new Date);n=Math.floor(n/364e5)*364e5;e(t).find(':findday("'+n+'")').removeClass("wd").addClass("today");break}},fillData:function(t,n,r){var s=function(e){try{e=e.replace("rgb(","").replace(")","");var t=e.split(",");var n=parseInt(t[0],10);var r=parseInt(t[1],10);var i=parseInt(t[2],10);var s=Math.round((255-(.299*n+.587*r+.114*i))*.9);return"rgb("+s+", "+s+", "+s+")"}catch(o){return""}};var a=function(e){try{e=e.replace("rgb(","").replace(")","");var t=e.split(",");var n=parseInt(t[0]);var r=parseInt(t[1]);var i=parseInt(t[2]);n=n-Math.round(parseInt(n)/7);r=r-Math.round(parseInt(r)/7);i=i-Math.round(parseInt(i)/7);return"rgb("+n+", "+r+", "+i+")"}catch(s){return""}};e.each(t.data,function(r,a){if(r>=t.pageNum*i.itemsPerPage&&r<t.pageNum*i.itemsPerPage+i.itemsPerPage){e.each(a.values,function(a,f){var l=null;switch(i.scale){case"hours":var c=u.genId(u.dateDeserialize(f.from).getTime(),t.scaleStep);var h=e(t).find("#dh-"+c);var p=u.genId(u.dateDeserialize(f.to).getTime(),t.scaleStep);var d=e(t).find("#dh-"+p);console.log(c,p);var v=h.attr("offset");var m=d.attr("offset");var g=Math.floor((m-v)/u.getCellSize())+1;l=o.createProgressBar(g,f.id?f.id:"",f.customClass?f.customClass:"",f.desc?f.desc:"",f.label?f.label:"",f.dataObj?f.dataObj:null);var y=e(t).find("#rowheader"+r);var b=u.getCellSize()*5+2+parseInt(y.attr("offset"),10);l.css({top:b,left:Math.floor(v)});n.append(l);break;case"weeks":var w=u.dateDeserialize(f.from);var E=u.dateDeserialize(f.to);if(w.getDate()<=3&&w.getMonth()===0){w.setDate(w.getDate()+4)}if(w.getDate()<=3&&w.getMonth()===0){w.setDate(w.getDate()+4)}if(E.getDate()<=3&&E.getMonth()===0){E.setDate(E.getDate()+4)}var h=e(t).find("#"+w.getWeekId());var v=h.attr("offset");var d=e(t).find("#"+E.getWeekId());var m=d.attr("offset");var g=Math.round((m-v)/u.getCellSize())+1;l=o.createProgressBar(g,f.id?f.id:"",f.customClass?f.customClass:"",f.desc?f.desc:"",f.label?f.label:"",f.dataObj?f.dataObj:null);var y=e(t).find("#rowheader"+r);var b=u.getCellSize()*3+2+parseInt(y.attr("offset"),10);l.css({top:b,left:Math.floor(v)});n.append(l);break;case"months":var w=u.dateDeserialize(f.from);var E=u.dateDeserialize(f.to);if(w.getDate()<=3&&w.getMonth()===0){w.setDate(w.getDate()+4)}if(w.getDate()<=3&&w.getMonth()===0){w.setDate(w.getDate()+4)}if(E.getDate()<=3&&E.getMonth()===0){E.setDate(E.getDate()+4)}var h=e(t).find("#dh-"+u.genId(w.getTime()));var v=h.attr("offset");var d=e(t).find("#dh-"+u.genId(E.getTime()));var m=d.attr("offset");var g=Math.round((m-v)/u.getCellSize())+1;l=o.createProgressBar(g,f.id?f.id:"",f.customClass?f.customClass:"",f.desc?f.desc:"",f.label?f.label:"",f.dataObj?f.dataObj:null);var y=e(t).find("#rowheader"+r);var b=u.getCellSize()*2+2+parseInt(y.attr("offset"),10);l.css({top:b,left:Math.floor(v)});n.append(l);break;default:var c=u.genId(u.dateDeserialize(f.from).getTime());var p=u.genId(u.dateDeserialize(f.to).getTime());var h=e(t).find("#dh-"+c);var v=h.attr("offset");var g=Math.floor((p/1e3-c/1e3)/86400)+1;l=o.createProgressBar(g,f.id?f.id:"",f.customClass?f.customClass:"",f.desc?f.desc:"",f.label?f.label:"",f.dataObj?f.dataObj:null);var y=e(t).find("#rowheader"+r);var b=u.getCellSize()*4+2+parseInt(y.attr("offset"),10);l.css({top:b,left:Math.floor(v)});n.append(l);break}var S=l.find(".fn-label");if(S&&l.length){var x=s(l[0].style.backgroundColor);S.css("color",x)}else if(S){S.css("color","")}})}})},navigateTo:function(t,n){var r=e(t).find(".fn-gantt .rightPanel");var i=r.find(".dataPanel");i.click=function(){alert(arguments.join(""))};var s=r.width();var u=i.width();switch(n){case"begin":i.animate({"margin-left":"0px"},"fast",function(){o.repositionLabel(t)});t.scrollNavigation.panelMargin=0;break;case"end":var a=u-s;t.scrollNavigation.panelMargin=a*-1;i.animate({"margin-left":"-"+a+"px"},"fast",function(){o.repositionLabel(t)});break;case"now":if(!t.scrollNavigation.canScroll||!i.find(".today").length){return false}var f=(u-s)*-1;var l=i.css("margin-left").replace("px","");var n=i.find(".today").offset().left-i.offset().left;n*=-1;if(n>0){n=0}else if(n<f){n=f}i.animate({"margin-left":n+"px"},"fast",o.repositionLabel(t));t.scrollNavigation.panelMargin=n;break;default:var f=(u-s)*-1;var l=i.css("margin-left").replace("px","");var n=parseInt(l,10)+n;if(n<=0&&n>=f){i.animate({"margin-left":n+"px"},"fast",o.repositionLabel(t))}t.scrollNavigation.panelMargin=n;break}o.synchronizeScroller(t)},navigatePage:function(t,n){if(t.pageNum+n>=0&&t.pageNum+n<Math.ceil(t.rowsNum/i.itemsPerPage)){o.waitToggle(t,true,function(){t.pageNum+=n;t.hPosition=e(".fn-gantt .dataPanel").css("margin-left").replace("px","");t.scaleOldWidth=false;o.init(t)})}},zoomInOut:function(t,n){o.waitToggle(t,true,function(){var s=n<0;var u=t.scaleStep+n*3;u=u<=1?1:u===4?3:u;var a=i.scale;var f=t.headerRows;if(i.scale==="hours"&&u>=13){a="days";f=4;u=13}else if(i.scale==="days"&&s){a="hours";f=5;u=12}else if(i.scale==="days"&&!s){a="weeks";f=3;u=13}else if(i.scale==="weeks"&&!s){a="months";f=2;u=14}else if(i.scale==="weeks"&&s){a="days";f=4;u=13}else if(i.scale==="months"&&s){a="weeks";f=3;u=13}if(s&&e.inArray(a,r)<e.inArray(i.minScale,r)||!s&&e.inArray(a,r)>e.inArray(i.maxScale,r)){o.init(t);return}t.scaleStep=u;i.scale=a;t.headerRows=f;var l=e(t).find(".fn-gantt .rightPanel");var c=l.find(".dataPanel");t.hPosition=c.css("margin-left").replace("px","");t.scaleOldWidth=c.width()-l.width();if(i.useCookie){e.cookie(this.cookieKey+"CurrentScale",i.scale);e.cookie(this.cookieKey+"ScrollPos",null)}o.init(t)})},mouseScroll:function(t,n){var r=e(t).find(".fn-gantt .dataPanel");r.css("cursor","move");var i=r.offset();var s=t.scrollNavigation.mouseX===null?n.pageX:t.scrollNavigation.mouseX;var u=n.pageX-s;t.scrollNavigation.mouseX=n.pageX;o.scrollPanel(t,u);clearTimeout(t.scrollNavigation.repositionDelay);t.scrollNavigation.repositionDelay=setTimeout(o.repositionLabel,50,t)},wheelScroll:function(e,t){t.preventDefault();var n=t.detail?t.detail*-50:t.wheelDelta/120*50;o.scrollPanel(e,n);clearTimeout(e.scrollNavigation.repositionDelay);e.scrollNavigation.repositionDelay=setTimeout(o.repositionLabel,50,e)},sliderScroll:function(t,n){var r=e(t).find(".nav-slider-bar");var i=r.find(".nav-slider-button");var s=e(t).find(".fn-gantt .rightPanel");var u=s.find(".dataPanel");var a=r.offset();var f=r.width();var l=i.width();var c,h;if(n.pageX>=a.left&&n.pageX<=a.left+f){c=n.pageX-a.left;c=c-l/2;i.css("left",c);h=u.width()-s.width();var p=c*h/f*-1;if(p>=0){u.css("margin-left","0px");t.scrollNavigation.panelMargin=0}else if(c>=f-l*1){u.css("margin-left",h*-1+"px");t.scrollNavigation.panelMargin=h*-1}else{u.css("margin-left",p+"px");t.scrollNavigation.panelMargin=p}clearTimeout(t.scrollNavigation.repositionDelay);t.scrollNavigation.repositionDelay=setTimeout(o.repositionLabel,5,t)}},scrollPanel:function(t,n){if(!t.scrollNavigation.canScroll){return false}var r=parseInt(t.scrollNavigation.panelMargin,10)+n;if(r>0){t.scrollNavigation.panelMargin=0;e(t).find(".fn-gantt .dataPanel").css("margin-left",t.scrollNavigation.panelMargin+"px")}else if(r<t.scrollNavigation.panelMaxPos*-1){t.scrollNavigation.panelMargin=t.scrollNavigation.panelMaxPos*-1;e(t).find(".fn-gantt .dataPanel").css("margin-left",t.scrollNavigation.panelMargin+"px")}else{t.scrollNavigation.panelMargin=r;e(t).find(".fn-gantt .dataPanel").css("margin-left",t.scrollNavigation.panelMargin+"px")}o.synchronizeScroller(t)},synchronizeScroller:function(t){if(i.navigate==="scroll"){var n=e(t).find(".fn-gantt .rightPanel");var r=n.find(".dataPanel");var s=e(t).find(".nav-slider-bar");var o=s.find(".nav-slider-button");var u=s.width();var a=o.width();var f=r.width()-n.width();var l=0;if(r.css("margin-left")){l=r.css("margin-left").replace("px","")}var c=l*u/f-o.width()*.25;c=c>0?0:c*-1>=u-a*.75?(u-a*1.25)*-1:c;o.css("left",c*-1)}},repositionLabel:function(t){setTimeout(function(){var n;if(!t){n=e(".fn-gantt .rightPanel .dataPanel")}else{var r=e(t).find(".fn-gantt .rightPanel");n=r.find(".dataPanel")}if(i.useCookie){e.cookie(this.cookieKey+"ScrollPos",n.css("margin-left").replace("px",""))}},500)},waitToggle:function(t,n,r){if(n){var s=e(t).offset();var o=e(t).outerWidth();var u=e(t).outerHeight();if(!t.loader){t.loader=e('<div class="fn-gantt-loader">'+'<div class="fn-gantt-loader-spinner"><span>'+i.waitText+"</span></div></div>")}e(t).append(t.loader);setTimeout(r,500)}else if(t.loader){t.loader.detach()}}};var u={getMaxDate:function(t){var n=null;e.each(t.data,function(t,r){e.each(r.values,function(e,t){n=n<u.dateDeserialize(t.to)?u.dateDeserialize(t.to):n})});n=n||new Date;switch(i.scale){case"hours":n.setHours(Math.ceil(n.getHours()/t.scaleStep)*t.scaleStep);n.setHours(n.getHours()+t.scaleStep*3);break;case"weeks":var r=new Date(n.getTime());var r=new Date(r.setDate(r.getDate()+3*7));var s=Math.floor(r.getDate()/7)*7;n=new Date(r.getFullYear(),r.getMonth(),s===0?4:s-3);break;case"months":var r=new Date(n.getFullYear(),n.getMonth(),1);r.setMonth(r.getMonth()+2);n=new Date(r.getFullYear(),r.getMonth(),1);break;default:n.setHours(0);n.setDate(n.getDate()+3);break}return n},getMinDate:function(t){var n=null;e.each(t.data,function(t,r){e.each(r.values,function(e,t){n=n>u.dateDeserialize(t.from)||n===null?u.dateDeserialize(t.from):n})});n=n||new Date;switch(i.scale){case"hours":n.setHours(Math.floor(n.getHours()/t.scaleStep)*t.scaleStep);n.setHours(n.getHours()-t.scaleStep*3);break;case"weeks":var r=new Date(n.getTime());var r=new Date(r.setDate(r.getDate()-3*7));var s=Math.floor(r.getDate()/7)*7;n=new Date(r.getFullYear(),r.getMonth(),s===0?4:s-3);break;case"months":var r=new Date(n.getFullYear(),n.getMonth(),1);r.setMonth(r.getMonth()-3);n=new Date(r.getFullYear(),r.getMonth(),1);break;default:n.setHours(0);n.setDate(n.getDate()-3);break}return n},parseDateRange:function(e,t){var n=new Date(e.getTime());var r=new Date(t.getTime());var i=[];var s=0;do{i[s++]=new Date(n.getTime());n.setDate(n.getDate()+1)}while(n.getTime()<=t.getTime());return i},parseTimeRange:function(e,t,n){var r=new Date(e);var i=new Date(t);r.setMilliseconds(0);r.setSeconds(0);r.setMinutes(0);r.setHours(0);i.setMilliseconds(0);i.setSeconds(0);if(i.getMinutes()>0||i.getHours()>0){i.setMinutes(0);i.setHours(0);i.setTime(i.getTime()+864e5)}var o=[];var u=0;for(;;){var a=new Date(r);a.setHours(Math.floor(r.getHours()/n)*n);if(o[u]&&a.getDay()!==o[u].getDay()){a.setHours(0)}o[u]=a;if(r.getTime()>t.getTime())break;r=s(a,n);u++}return o},parseWeeksRange:function(e,t){var n=new Date(e);var r=new Date(t);var i=[];var s=0;do{if(n.getDay()===0){i[s++]=n.getDayForWeek()}n.setDate(n.getDate()+1)}while(n.getTime()<=t.getTime());return i},parseMonthsRange:function(e,t){var n=new Date(e);var r=new Date(t);var i=[];var s=0;do{i[s++]=new Date(n.getFullYear(),n.getMonth(),1);n.setMonth(n.getMonth()+1)}while(n.getTime()<=t.getTime());return i},dateDeserialize:function(t){if(typeof t==="string"){t=t.replace(/\/Date\((.*)\)\//,"$1");t=e.isNumeric(t)?parseInt(t,10):e.trim(t)}return new Date(t)},genId:function(e){var t=new Date(e);switch(i.scale){case"hours":var n=t.getHours();if(arguments.length>=2){n=Math.floor(t.getHours()/arguments[1])*arguments[1]}return(new Date(t.getFullYear(),t.getMonth(),t.getDate(),n)).getTime();case"weeks":var r=t.getFullYear();var s=t.getDayForWeek().getWeekOfYear();var o=t.getMonth();if(o===11&&s===1){r++}return r+"-"+s;case"months":return t.getFullYear()+"-"+t.getMonth();default:return(new Date(t.getFullYear(),t.getMonth(),t.getDate())).getTime()}},_datesToDays:function(e){var t={};for(var n=0,r=e.length,i;n<r;n++){i=u.dateDeserialize(e[n]);t[i.setHours(0,0,0,0)]=true}return t},isHoliday:function(){if(!i.holidays){return function(){return false}}var t=false;return function(n){if(!t){t=u._datesToDays(i.holidays)}return!!t[e.isNumeric(n)?n:(new Date(n.getFullYear(),n.getMonth(),n.getDate())).getTime()]}}(),_getCellSize:null,getCellSize:function(){if(!u._getCellSize){e("body").append(e('<div style="display: none; position: absolute;" class="fn-gantt" id="measureCellWidth"><div class="row"></div></div>'));u._getCellSize=e("#measureCellWidth .row").height();e("#measureCellWidth").empty().remove()}return u._getCellSize},getRightPanelSize:function(){e("body").append(e('<div style="display: none; position: absolute;" class="fn-gantt" id="measureCellWidth"><div class="rightPanel"></div></div>'));var t=e("#measureCellWidth .rightPanel").height();e("#measureCellWidth").empty().remove();return t},getPageHeight:function(e){return e.pageNum+1===e.pageCount?e.rowsOnLastPage*u.getCellSize():i.itemsPerPage*u.getCellSize()},_getProgressBarMargin:null,getProgressBarMargin:function(){if(!u._getProgressBarMargin&&u._getProgressBarMargin!==0){e("body").append(e('<div style="display: none; position: absolute;" id="measureBarWidth" ><div class="fn-gantt"><div class="rightPanel"><div class="dataPanel"><div class="row day"><div class="bar" /></div></div></div></div></div>'));u._getProgressBarMargin=parseInt(e("#measureBarWidth .fn-gantt .rightPanel .day .bar").css("margin-left").replace("px",""),10);u._getProgressBarMargin+=parseInt(e("#measureBarWidth .fn-gantt .rightPanel .day .bar").css("margin-right").replace("px",""),10);e("#measureBarWidth").empty().remove()}return u._getProgressBarMargin}};this.each(function(){this.data=null;this.pageNum=0;this.pageCount=0;this.rowsOnLastPage=0;this.rowsNum=0;this.hPosition=0;this.dateStart=null;this.dateEnd=null;this.scrollClicked=false;this.scaleOldWidth=null;this.headerRows=null;if(i.useCookie){var t=e.cookie(this.cookieKey+"CurrentScale");if(t){i.scale=e.cookie(this.cookieKey+"CurrentScale")}else{e.cookie(this.cookieKey+"CurrentScale",i.scale)}}switch(i.scale){case"hours":this.headerRows=5;this.scaleStep=1;break;case"weeks":this.headerRows=3;this.scaleStep=13;break;case"months":this.headerRows=2;this.scaleStep=14;break;default:this.headerRows=4;this.scaleStep=13;break}this.scrollNavigation={panelMouseDown:false,scrollerMouseDown:false,mouseX:null,panelMargin:0,repositionDelay:0,panelMaxPos:0,canScroll:true};this.gantt=null;this.loader=null;o.create(this)})}})(jQuery)
